
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-04-14
 Rendered using Reflow Maven Skin 1.1.0 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Joins | Apache Phoenix</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="//netdna.bootstrapcdn.com/bootswatch/2.3.2/flatly/bootstrap.min.css" rel="stylesheet" />
		<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="//yandex.st/highlightjs/7.5/styles/default.min.css" rel="stylesheet" />
		
		<link href="./css/lightbox.css" rel="stylesheet" />
		
		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-joins project-phoenix-site" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html"><div class="xtoplogo"></div></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="index.html" title="Overview">Overview</a></li>
									<li ><a href="recent.html" title="New Features">New Features</a></li>
									<li ><a href="roadmap.html" title="Roadmap">Roadmap</a></li>
									<li ><a href="performance.html" title="Performance">Performance</a></li>
									<li ><a href="team.html" title="Team">Team</a></li>
									<li ><a href="resources.html" title="Resources">Resources</a></li>
									<li ><a href="mailing_list.html" title="Mailing Lists">Mailing Lists</a></li>
									<li ><a href="source.html" title="Source Repository">Source Repository</a></li>
									<li ><a href="issues.html" title="Issue Tracking">Issue Tracking</a></li>
									<li ><a href="download.html" title="Download">Download</a></li>
									<li ><a href="installation.html" title="Installation">Installation</a></li>
									<li class="divider"/>
									<li ><a href="who_is_using.html" title="Who is Using">Who is Using</a></li>
									<li ><a href="contributing.html" title="How to Contribute">How to Contribute</a></li>
									<li ><a href="develop.html" title="How to Develop">How to Develop</a></li>
									<li ><a href="building_website.html" title="How to Update Website">How to Update Website</a></li>
									<li ><a href="release.html" title="How to Release">How to Release</a></li>
									<li class="divider"/>
									<li ><a href="http://www.apache.org/licenses/" title="License" class="externalLink">License</a></li>
									<li ><a href="http://www.apache.org/foundation/sponsorship.html" title="Sponsorship" class="externalLink">Sponsorship</a></li>
									<li ><a href="http://www.apache.org/foundation/thanks.html" title="Thanks" class="externalLink">Thanks</a></li>
									<li ><a href="http://www.apache.org/security/" title="Security" class="externalLink">Security</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Using <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="faq.html" title="F.A.Q.">F.A.Q.</a></li>
									<li ><a href="Phoenix-in-15-minutes-or-less.html" title="Quick Start">Quick Start</a></li>
									<li ><a href="building.html" title="Building">Building</a></li>
									<li ><a href="tuning.html" title="Tuning">Tuning</a></li>
									<li ><a href="upgrading.html" title="Upgrading">Upgrading</a></li>
									<li class="divider"/>
									<li ><a href="secondary_indexing.html" title="Secondary Indexes">Secondary Indexes</a></li>
									<li class="active"><a href="" title="Joins">Joins</a></li>
									<li ><a href="subqueries.html" title="Subqueries">Subqueries</a></li>
									<li ><a href="views.html" title="Views">Views</a></li>
									<li ><a href="multi-tenancy.html" title="Multi tenancy">Multi tenancy</a></li>
									<li ><a href="sequences.html" title="Sequences">Sequences</a></li>
									<li ><a href="array_type.html" title="ARRAY type">ARRAY type</a></li>
									<li ><a href="salted.html" title="Salted Tables">Salted Tables</a></li>
									<li ><a href="paged.html" title="Paged Queries">Paged Queries</a></li>
									<li ><a href="dynamic_columns.html" title="Dynamic Columns">Dynamic Columns</a></li>
									<li ><a href="skip_scan.html" title="Skip Scan">Skip Scan</a></li>
									<li ><a href="bulk_dataload.html" title="Bulk Loading">Bulk Loading</a></li>
									<li ><a href="tracing.html" title="Tracing">Tracing</a></li>
									<li ><a href="update_statistics.html" title="Statistics Collection">Statistics Collection</a></li>
									<li ><a href="pherf.html" title="Performance Testing">Performance Testing</a></li>
									<li class="divider"/>
									<li ><a href="phoenix_on_emr.html" title="Amazon EMR Support">Amazon EMR Support</a></li>
									<li ><a href="flume.html" title="Apache Flume Plugin">Apache Flume Plugin</a></li>
									<li ><a href="pig_integration.html" title="Apache Pig Integration">Apache Pig Integration</a></li>
									<li ><a href="phoenix_mr.html" title="Map Reduce Integration">Map Reduce Integration</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="language/index.html" title="Grammar">Grammar</a></li>
									<li ><a href="language/functions.html" title="Functions">Functions</a></li>
									<li ><a href="language/datatypes.html" title="Datatypes">Datatypes</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->

	<header>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="page-header">
 <h1>Joins</h1>
</div> 
<p>The standard SQL join syntax (with some limitations) is now supported by Phoenix to combine records from two or more tables based on their fields having common values.</p> 
<p>For example, we have the following tables to store our order records, our customer information and the item information we sell in those orders.</p> 
<p>The “<b>Orders</b>” table:</p> 
<table border="0" class="bodyTable table table-striped table-hover"> 
 <thead> 
  <tr class="a"> 
   <th>OrderID </th> 
   <th>CustomerID </th> 
   <th>ItemID </th> 
   <th>Quantity </th> 
   <th>Date</th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr class="b"> 
   <td>1630781 </td> 
   <td>C004 </td> 
   <td>I001 </td> 
   <td>650 </td> 
   <td>09-01-2013</td> 
  </tr> 
  <tr class="a"> 
   <td>1630782 </td> 
   <td>C003 </td> 
   <td>I006 </td> 
   <td>2500 </td> 
   <td>09-02-2013</td> 
  </tr> 
  <tr class="b"> 
   <td>1630783 </td> 
   <td>C002 </td> 
   <td>I002 </td> 
   <td>340 </td> 
   <td>09-03-2013</td> 
  </tr> 
  <tr class="a"> 
   <td>1630784 </td> 
   <td>C004 </td> 
   <td>I006 </td> 
   <td>1260 </td> 
   <td>09-04-2013</td> 
  </tr> 
  <tr class="b"> 
   <td>1630785 </td> 
   <td>C005 </td> 
   <td>I003 </td> 
   <td>1500 </td> 
   <td>09-05-2013</td> 
  </tr> 
 </tbody> 
</table> 
<p>The “<b>Customers</b>” table:</p> 
<table border="0" class="bodyTable table table-striped table-hover"> 
 <thead> 
  <tr class="a"> 
   <th>CustomerID </th> 
   <th>CustomerName </th> 
   <th>Country</th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr class="b"> 
   <td>C001 </td> 
   <td>Telefunken </td> 
   <td>Germany</td> 
  </tr> 
  <tr class="a"> 
   <td>C002 </td> 
   <td>Logica </td> 
   <td>Belgium</td> 
  </tr> 
  <tr class="b"> 
   <td>C003 </td> 
   <td>Salora Oy </td> 
   <td>Finland</td> 
  </tr> 
  <tr class="a"> 
   <td>C004 </td> 
   <td>Alps Nordic AB </td> 
   <td>Sweden</td> 
  </tr> 
  <tr class="b"> 
   <td>C005 </td> 
   <td>Deister Electronics </td> 
   <td>Germany</td> 
  </tr> 
  <tr class="a"> 
   <td>C006 </td> 
   <td>Thales Nederland </td> 
   <td>Netherlands</td> 
  </tr> 
 </tbody> 
</table> 
<p>The “<b>Items</b>” table:</p> 
<table border="0" class="bodyTable table table-striped table-hover"> 
 <thead> 
  <tr class="a"> 
   <th>ItemID </th> 
   <th>ItemName </th> 
   <th>Price</th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr class="b"> 
   <td>I001 </td> 
   <td>BX016 </td> 
   <td>15.96</td> 
  </tr> 
  <tr class="a"> 
   <td>I002 </td> 
   <td>MU947 </td> 
   <td>20.35</td> 
  </tr> 
  <tr class="b"> 
   <td>I003 </td> 
   <td>MU3508 </td> 
   <td>9.60</td> 
  </tr> 
  <tr class="a"> 
   <td>I004 </td> 
   <td>XC7732 </td> 
   <td>55.24</td> 
  </tr> 
  <tr class="b"> 
   <td>I005 </td> 
   <td>XT0019 </td> 
   <td>12.65</td> 
  </tr> 
  <tr class="a"> 
   <td>I006 </td> 
   <td>XT2217 </td> 
   <td>12.35</td> 
  </tr> 
 </tbody> 
</table> 
<p>You may get a combined view of the “Orders” table and the “Customers” table by running the following join query:</p> 
<div class="source"> 
 <pre>SELECT O.OrderID, C.CustomerName, C.Country, O.Date
FROM Orders AS O
INNER JOIN Customers AS C
ON O.CustomerID = C.CustomerID;
</pre> 
</div> 
<p>This will produce results like:</p> 
<table border="0" class="bodyTable table table-striped table-hover"> 
 <thead> 
  <tr class="a"> 
   <th>O.OrderID </th> 
   <th>C.CustomerName </th> 
   <th>C.Country </th> 
   <th>O.Date</th> 
  </tr> 
 </thead> 
 <tbody> 
  <tr class="b"> 
   <td>1630781 </td> 
   <td>Alps Nordic AB </td> 
   <td>Sweden </td> 
   <td>09-01-2013</td> 
  </tr> 
  <tr class="a"> 
   <td>1630782 </td> 
   <td>Salora Oy </td> 
   <td>Finland </td> 
   <td>09-02-2013</td> 
  </tr> 
  <tr class="b"> 
   <td>1630783 </td> 
   <td>Logica </td> 
   <td>Belgium </td> 
   <td>09-03-2013</td> 
  </tr> 
  <tr class="a"> 
   <td>1630784 </td> 
   <td>Alps Nordic AB </td> 
   <td>Sweden </td> 
   <td>09-04-2013</td> 
  </tr> 
  <tr class="b"> 
   <td>1630785 </td> 
   <td>Deister Electronics </td> 
   <td>Germany </td> 
   <td>09-05-2013</td> 
  </tr> 
 </tbody> 
</table> 
<div class="section"> 
 <h2 id="Joining_Tables_with_Indices">Joining Tables with Indices</h2> 
 <p>Secondary indices will be automatically utilized when running join queries. For example, if we create indices on the “Orders” table and the “Items” table respectively, which are defined as follows:</p> 
 <div class="source"> 
  <pre>CREATE INDEX iOrders ON Orders (ItemID) INCLUDE (CustomerID, Quantity);
CREATE INDEX i2Orders ON Orders (CustomerID) INCLUDE (ItemID, Quantity);
CREATE INDEX iItems ON Items (ItemName) INCLUDE (Price);
</pre> 
 </div> 
 <p><a name="joining-tables-with-indices-eg1"></a>We can find out each item’s total sales value by joining the “Items” table and the “Orders” table and then grouping the joined result with “ItemName” (and also adding some filtering conditions):</p> 
 <div class="source"> 
  <pre>SELECT ItemName, sum(Price * Quantity) AS OrderValue
FROM Items
JOIN Orders
ON Items.ItemID = Orders.ItemID
WHERE Orders.CustomerID &gt; 'C002'
GROUP BY ItemName;
</pre> 
 </div> 
 <p>The results will be like:</p> 
 <table border="0" class="bodyTable table table-striped table-hover"> 
  <thead> 
   <tr class="a"> 
    <th>ItemName </th> 
    <th>OrderValue</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr class="b"> 
    <td>BX016 </td> 
    <td>10374</td> 
   </tr> 
   <tr class="a"> 
    <td>MU3508 </td> 
    <td>14400</td> 
   </tr> 
   <tr class="b"> 
    <td>XT2217 </td> 
    <td>46436</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>The execution plan for this query (by running “EXPLAIN <i>query</i>”) will be:</p> 
 <div class="source"> 
  <pre>CLIENT PARALLEL 32-WAY FULL SCAN OVER iItems 
    SERVER AGGREGATE INTO ORDERED DISTINCT ROWS BY [iItems.0:ItemName] 
CLIENT MERGE SORT 
    PARALLEL INNER-JOIN TABLE 0 
        CLIENT PARALLEL 32-WAY RANGE SCAN OVER i2Orders ['C002'] - [*]
</pre> 
 </div> 
 <p>In this case, the index table “iItems” is used in place of the data table “Items” since the index table “iItems” is indexed on column “ItemName” and will hence benefit the GROUP-BY clause in this query. Meanwhile, the index table “i2Orders” is favored over the data table “Orders” and another index table “iOrders” because a range scan instead of a full scan can be applied as a result of the WHERE clause.</p> 
</div> 
<div class="section"> 
 <h2 id="grouped-joins-and-derived-tables">Grouped Joins and Derived Tables<a name="Grouped_Joins_and_Derived_Tables"></a></h2> 
 <p>Phoenix also supports complex join syntax such as grouped joins (or sub joins) and joins with derived-tables. You can group joins by using parenthesis to prioritize certain joins before other joins are executed. You can also replace any one (or more) of your join tables with a subquery (derived table), which could be yet another join query.</p> 
 <p>For grouped joins, you can write something like:</p> 
 <div class="source"> 
  <pre>SELECT O.OrderID, I.ItemName, S.SupplierName
FROM Orders AS O
LEFT JOIN
    (Items AS I
     INNER JOIN Suppliers AS S
     ON I.SupplierID = S.SupplierID)
ON O.ItemID = I.ItemID;
</pre> 
 </div> 
 <p>By replacing the sub join with a subquery (derived table), we get an equivalent query as:</p> 
 <div class="source"> 
  <pre>SELECT O.OrderID, J.ItemName, J.SupplierName
FROM Orders AS O
LEFT JOIN
    (SELECT ItemID, ItemName, SupplierName
     FROM Items AS I
     INNER JOIN Suppliers AS S
     ON I.SupplierID = S.SupplierID) AS J
ON O.ItemID = J.ItemID;
</pre> 
 </div> 
 <p>As an alternative to the <a href="#joining-tables-with-indices-eg1">earlier example</a> where we try to find out each item’s sales figures, instead of using group-by after joining the two tables, we can join the “Items” table with the grouped result from the “Orders” table:</p> 
 <div class="source"> 
  <pre>SELECT ItemName, O.OrderValue
FROM Items
JOIN
    (SELECT ItemID, sum(Price * Quantity) AS OrderValue
     FROM Orders
     WHERE CustomerID &gt; 'C002'
     GROUP BY ItemID) AS O
ON Items.ItemID = O.ItemID;
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Hash_Join_vs._Sort-Merge_Join">Hash Join vs. Sort-Merge Join</h2> 
 <p>Basic hash join usually outperforms other types of join algorithms, but it has its limitations too, the most significant of which is the assumption that one of the relations must be small enough to fit into memory. Thus Phoenix now has both hash join and sort-merge join implemented to facilitate fast join operations as well as join between two large tables.</p> 
 <p>Phoenix currently uses the hash join algorithm whenever possible since it is usually much faster. However we have the hint “USE_SORT_MERGE_JOIN” for forcing the usage of sort-merge join in a query. The choice between these two join algorithms, together with detecting the smaller relation for hash join, will be done automatically in future under the guidance provided by table statistics.</p> 
</div> 
<div class="section"> 
 <h2 id="foreign-key-to-primary-key-join-optimization">Foreign Key to Primary Key Join Optimization<a name="Foreign_Key_to_Primary_Key_Join_Optimization"></a></h2> 
 <p>Oftentimes a join will occur from a child table to a parent table, mapping the foreign key of the child table to the primary key of the parent. So instead of doing a full scan on the parent table, Phoenix will drive a skip-scan or a range-scan based on the foreign key values it got from the child table result.</p> 
 <p>Phoenix will extract and sort multiple key parts from the join keys so that it can get the most accurate key hints/ranges possible for the parent table scan.</p> 
 <p>For example, we have parent table “Employee” and child table “Patent” defined as:</p> 
 <div class="source"> 
  <pre>CREATE TABLE Employee (
    Region VARCHAR NOT NULL,
    LocalID VARCHAR NOT NULL,
    Name VARCHAR NOT NULL,
    StartDate DATE NOT NULL,
    CONSTRAINT pk PRIMARY KEY (Region, LocalID));

CREATE TABLE Patent (
    PatentID VARCHAR NOT NULL,
    Region VARCHAR NOT NULL,
    LocalID VARCHAR NOT NULL,
    Title VARCHAR NOT NULL,
    Category VARCHAR NOT NULL,
    FileDate DATE NOT NULL,
    CONSTRAINT pk PRIMARY KEY (PatentID));
</pre> 
 </div> 
 <p>Now we’d like to find out all those employees who filed patents after January 2000 and list their names according to their patent count:</p> 
 <div class="source"> 
  <pre>SELECT E.Name, E.Region, P.PCount
FROM Employee AS E
JOIN
    (SELECT Region, LocalID, count(*) AS PCount
     FROM Patent
     WHERE P.FileDate &gt;= to_date('2000/01/01')
     GROUP BY Region, LocalID) AS P
ON E.Region = P.Region AND E.LocalID = P.LocalID
</pre> 
 </div> 
 <p>The above statement will do a skip-scan over the “Employee” table and will use both join key “Region” and “LocalID” for runtime key hint calculation. Below is the execution time of this query with and without this optimization on an “Employee” table of about <i>5000000</i> records and a “Patent” table of about <i>1000</i> records: </p> 
 <table border="0" class="bodyTable table table-striped table-hover"> 
  <thead> 
   <tr class="a"> 
    <th>W/O Optimization </th> 
    <th>W/ Optimization</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr class="b"> 
    <td>8.1s </td> 
    <td>0.4s</td> 
   </tr> 
  </tbody> 
 </table> 
 <p>However, there are times when the foreign key values from the child table account for a complete primary key space in the parent table, thus using skip-scans would only be slower not faster. Yet you can always turn off the optimization by specifying hint “NO_CHILD_PARENT_OPTIMIZATION”. Furthermore, table statistics will soon come in to help making smarter choices between the two schemes.</p> 
</div> 
<div class="section"> 
 <h2 id="Configuration">Configuration</h2> 
 <p>As mentioned earlier, if we decide to use the hash join approach for our join queries, the prerequisite is that either of the relations can be small enough to fit into memory in order to be broadcast over all servers that have the data of concern from the other relation. And aside from making sure that the region server heap size is big enough to hold the smaller relation, we might also need to pay a attention to a few configuration parameters that are crucial to running hash joins.</p> 
 <p>The servers-side caches are used to hold the hash table built upon the smaller relation. The size and the living time of the caches are controlled by the following parameters. Note that a relation can be a physical table, a view, a subquery, or a joined result of other relations in a multiple-join query.</p> 
 <ol style="list-style-type: decimal"> 
  <li>phoenix.query.maxServerCacheBytes 
   <ul> 
    <li>Maximum size (in bytes) of the raw results of a relation before being compressed and sent over to the region servers.</li> 
    <li>Attempting to serializing the raw results of a relation with a size bigger than this setting will result in a MaxServerCacheSizeExceededException.</li> 
    <li><b>Default: 104,857,600</b></li> 
   </ul></li> 
  <li>phoenix.query.maxGlobalMemoryPercentage 
   <ul> 
    <li>Percentage of total heap memory (i.e. Runtime.getRuntime().maxMemory()) that all threads may use.</li> 
    <li>The summed size of all living caches must be smaller than this global memory pool size. Otherwise, you would get an InsufficientMemoryException.</li> 
    <li><b>Default: 15</b></li> 
   </ul></li> 
  <li>phoenix.coprocessor.maxServerCacheTimeToLiveMs 
   <ul> 
    <li>Maximum living time (in milliseconds) of server caches. A cache entry expires after this amount of time has passed since last access.</li> 
    <li>Consider adjusting this parameter when a server-side IOException(“<i>Could not find hash cache for joinId</i>”) happens. Getting warnings like “<i>Earlier hash cache(s) might have expired on servers</i>” might also be a sign that this number should be increased.</li> 
    <li><b>Default: 30,000</b></li> 
   </ul></li> 
 </ol> 
 <p>See our <a href="tuning.html">Configuration and Tuning Guide</a> for more details.</p> 
 <p>Although changing parameters can sometimes be a solution to getting rid of the exceptions mentioned above, it is highly recommended that you first consider optimizing the join queries according to the information provided in the following section.</p> 
</div> 
<div class="section"> 
 <h2 id="Optimizing_Your_Query">Optimizing Your Query</h2> 
 <p>Now that we know if using hash join it is most crucial to make sure that there will be enough memory for the query execution, but other than rush to change the configuration immediately, sometimes all you need to do is to know a bit of the interiors and adjust the sequence of the tables that appear in your join query.</p> 
 <p>Below is a description of the default join order (without the presence of table statistics) and of which side of the query will be taken as the “smaller” relation and be put into server cache:</p> 
 <ol style="list-style-type: decimal"> 
  <li> <p><i>lhs</i> INNER JOIN <i>rhs</i></p> <p><i>rhs</i> will be built as hash table in server cache.</p></li> 
  <li> <p><i>lhs</i> LEFT OUTER JOIN <i>rhs</i></p> <p><i>rhs</i> will be built as hash table in server cache.</p></li> 
  <li> <p><i>lhs</i> RIGHT OUTER JOIN <i>rhs</i></p> <p><i>lhs</i> will be built as hash table in server cache.</p></li> 
 </ol> 
 <p>The join order is more complicated with multiple-join queries. You can try running “EXPLAIN <i>join_query</i>” to look at the actual execution plan. For multiple-inner-join queries, Phoenix applies star-join optimization by default, which means the leading (left-hand-side) table will be scanned only once joining all right-hand-side tables at the same time. You can turn off this optimization by specifying the hint “NO_STAR_JOIN” in your query if the overall size of all right-hand-side tables would exceed the memory size limit.</p> 
 <p>Let’s take the previous query for example:</p> 
 <div class="source"> 
  <pre>SELECT O.OrderID, C.CustomerName, I.ItemName, I.Price, O.Quantity
FROM Orders AS O
INNER JOIN Customers AS C
ON O.CustomerID = C.CustomerID
INNER JOIN Items AS I
ON O.ItemID = I.ItemID;
</pre> 
 </div> 
 <p>The default join order (using star-join optimization) will be:</p> 
 <div class="source"> 
  <pre>1. SCAN Customers --&gt; BUILD HASH[0]
   SCAN Items --&gt; BUILD HASH[1]
2. SCAN Orders JOIN HASH[0], HASH[1] --&gt; Final Resultset
</pre> 
 </div> 
 <p>Alternatively, if we use hint “NO_STAR_JOIN”:</p> 
 <div class="source"> 
  <pre>SELECT /*+ NO_STAR_JOIN*/ O.OrderID, C.CustomerName, I.ItemName, I.Price, O.Quantity
FROM Orders AS O
INNER JOIN Customers AS C
ON O.CustomerID = C.CustomerID
INNER JOIN Items AS I
ON O.ItemID = I.ItemID;
</pre> 
 </div> 
 <p>The join order will be:</p> 
 <div class="source"> 
  <pre>1. SCAN Customers --&gt; BUILD HASH[0]
2. SCAN Orders JOIN HASH[0]; CLOSE HASH[0] --&gt; BUILD HASH[1]
3. SCAN Items JOIN HASH[1] --&gt; Final Resultset
</pre> 
 </div> 
 <p>It is also worth mentioning that not the entire dataset of the table should be counted into the memory consumption. Instead, only those columns used by the query, and of only the records that satisfy the predicates will be built into the server hash table.</p> 
</div> 
<div class="section"> 
 <h2 id="Limitations">Limitations</h2> 
 <p>In our Phoenix 3.3.0 and 4.3.0 releases, joins have the following restrictions and improvements to be made:</p> 
 <ol style="list-style-type: decimal"> 
  <li><a class="externalLink" href="https://issues.apache.org/jira/browse/PHOENIX-1555">PHOENIX-1555</a>: Fallback to many-to-many join if hash join fails due to insufficient memory.</li> 
  <li><a class="externalLink" href="https://issues.apache.org/jira/browse/PHOENIX-1556">PHOENIX-1556</a>: Base hash join versus many-to-many decision on how many guideposts will be traversed for RHS table(s).</li> 
 </ol> 
 <p>Continuous efforts are being made to bring in more performance enhancement for join queries based on table statistics. Please refer to our <a href="roadmap.html">Roadmap</a> for more information.</p> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">About</li>
						<li >
							<a href="index.html" title="Overview">Overview</a>
						</li>
						<li >
							<a href="recent.html" title="New Features">New Features</a>
						</li>
						<li >
							<a href="roadmap.html" title="Roadmap">Roadmap</a>
						</li>
						<li >
							<a href="performance.html" title="Performance">Performance</a>
						</li>
						<li >
							<a href="team.html" title="Team">Team</a>
						</li>
						<li >
							<a href="resources.html" title="Resources">Resources</a>
						</li>
						<li >
							<a href="mailing_list.html" title="Mailing Lists">Mailing Lists</a>
						</li>
						<li >
							<a href="source.html" title="Source Repository">Source Repository</a>
						</li>
						<li >
							<a href="issues.html" title="Issue Tracking">Issue Tracking</a>
						</li>
						<li >
							<a href="download.html" title="Download">Download</a>
						</li>
						<li >
							<a href="installation.html" title="Installation">Installation</a>
						</li>
						<li >
							<a href="http:divider" title=""></a>
						</li>
						<li >
							<a href="who_is_using.html" title="Who is Using">Who is Using</a>
						</li>
						<li >
							<a href="contributing.html" title="How to Contribute">How to Contribute</a>
						</li>
						<li >
							<a href="develop.html" title="How to Develop">How to Develop</a>
						</li>
						<li >
							<a href="building_website.html" title="How to Update Website">How to Update Website</a>
						</li>
						<li >
							<a href="release.html" title="How to Release">How to Release</a>
						</li>
						<li >
							<a href="http:divider" title=""></a>
						</li>
						<li >
							<a href="http://www.apache.org/licenses/" title="License" class="externalLink">License</a>
						</li>
						<li >
							<a href="http://www.apache.org/foundation/sponsorship.html" title="Sponsorship" class="externalLink">Sponsorship</a>
						</li>
						<li >
							<a href="http://www.apache.org/foundation/thanks.html" title="Thanks" class="externalLink">Thanks</a>
						</li>
						<li >
							<a href="http://www.apache.org/security/" title="Security" class="externalLink">Security</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Using</li>
						<li >
							<a href="faq.html" title="F.A.Q.">F.A.Q.</a>
						</li>
						<li >
							<a href="Phoenix-in-15-minutes-or-less.html" title="Quick Start">Quick Start</a>
						</li>
						<li >
							<a href="building.html" title="Building">Building</a>
						</li>
						<li >
							<a href="tuning.html" title="Tuning">Tuning</a>
						</li>
						<li >
							<a href="upgrading.html" title="Upgrading">Upgrading</a>
						</li>
						<li >
							<a href="http:divider" title=""></a>
						</li>
						<li >
							<a href="secondary_indexing.html" title="Secondary Indexes">Secondary Indexes</a>
						</li>
						<li class="active">
							<a href="#" title="Joins">Joins</a>
						</li>
						<li >
							<a href="subqueries.html" title="Subqueries">Subqueries</a>
						</li>
						<li >
							<a href="views.html" title="Views">Views</a>
						</li>
						<li >
							<a href="multi-tenancy.html" title="Multi tenancy">Multi tenancy</a>
						</li>
						<li >
							<a href="sequences.html" title="Sequences">Sequences</a>
						</li>
						<li >
							<a href="array_type.html" title="ARRAY type">ARRAY type</a>
						</li>
						<li >
							<a href="salted.html" title="Salted Tables">Salted Tables</a>
						</li>
						<li >
							<a href="paged.html" title="Paged Queries">Paged Queries</a>
						</li>
						<li >
							<a href="dynamic_columns.html" title="Dynamic Columns">Dynamic Columns</a>
						</li>
						<li >
							<a href="skip_scan.html" title="Skip Scan">Skip Scan</a>
						</li>
						<li >
							<a href="bulk_dataload.html" title="Bulk Loading">Bulk Loading</a>
						</li>
						<li >
							<a href="tracing.html" title="Tracing">Tracing</a>
						</li>
						<li >
							<a href="update_statistics.html" title="Statistics Collection">Statistics Collection</a>
						</li>
						<li >
							<a href="pherf.html" title="Performance Testing">Performance Testing</a>
						</li>
						<li >
							<a href="http:divider" title=""></a>
						</li>
						<li >
							<a href="phoenix_on_emr.html" title="Amazon EMR Support">Amazon EMR Support</a>
						</li>
						<li >
							<a href="flume.html" title="Apache Flume Plugin">Apache Flume Plugin</a>
						</li>
						<li >
							<a href="pig_integration.html" title="Apache Pig Integration">Apache Pig Integration</a>
						</li>
						<li >
							<a href="phoenix_mr.html" title="Map Reduce Integration">Map Reduce Integration</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Reference</li>
						<li >
							<a href="language/index.html" title="Grammar">Grammar</a>
						</li>
						<li >
							<a href="language/functions.html" title="Functions">Functions</a>
						</li>
						<li >
							<a href="language/datatypes.html" title="Datatypes">Datatypes</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<form action="http://search-hadoop.com/?" method="get"><input value="Phoenix" name="fc_project" type="hidden"><input placeholder="Search Phoenix&hellip;" required="required" style="width:170px;" size="18" name="q" id="query" type="search"></form>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015 <a href="http://www.apache.org">Apache Software Foundation</a>. All Rights Reserved.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	
	<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.js"></script>
	<script src="./js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="./js/jquery.ba-bbq.min.js"></script>
	<script src="//yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>
	
	</body>
</html>
